//Author: Abhishek Parolkar ( abhishek@parolkar.com )



GeoMereLaal = function(){
    
  
  return {
    lat: function(){
      return this.getCookie("latitude"); 
      },
    lng: function(){
      return this.getCookie("longitude");
      },
    setCookie: function (c_name,value,expiredays)
	  {
	    var exdate=new Date();
	    exdate.setDate(exdate.getDate()+expiredays);
	    document.cookie=c_name+ "=" +escape(value)+
	    ((expiredays==null) ? "" : ";expires="+exdate.toGMTString());
	  },
	getCookie: function (c_name)
	  {
	    if (document.cookie.length>0)
	      {
	        c_start=document.cookie.indexOf(c_name + "=");
	        if (c_start!=-1)
	          {
	          c_start=c_start + c_name.length+1;
	          c_end=document.cookie.indexOf(";",c_start);
	          if (c_end==-1) c_end=document.cookie.length;
	          return unescape(document.cookie.substring(c_start,c_end));
	          }
	      }
	return "";
	},
	dataExpires: 1, //These are number of days
    isBrowserCompatible: function(){   
      var userAgent = navigator.userAgent.toLowerCase();
	  // Figure out what browser is being used in Jquery Style
	  this.browser = {
		version: (userAgent.match( /.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/ ) || [0,'0'])[1],
		safari: /webkit/.test( userAgent ),
		opera: /opera/.test( userAgent ),
		msie: /msie/.test( userAgent ) && !/opera/.test( userAgent ),
		mozilla: /mozilla/.test( userAgent ) && !/(compatible|webkit)/.test( userAgent )
	  };

      if (this.browser.mozilla && navigator.geolocation) {  
	     return true; 
	   } else {  
	     return false;  
	   }

      },
    fetch: function(){
      if(this.isBrowserCompatible())
        { 

          navigator.geolocation.getCurrentPosition(function(position) {    
            
	        GeoMereLaal.setCookie("latitude",position.coords.latitude,GeoMereLaal.dataExpires);
	        GeoMereLaal.setCookie("longitude",position.coords.longitude,GeoMereLaal.dataExpires); 
	        GeoMereLaal.successCallbacks();
	        
	      },GeoMereLaal.onError);
          return true;

        }else{return false;}
      },
    request:function(){ 
      var lat = this.lat();
      var lng = this.lng();
      if(lat =='' || lng == '')
        {
          this.fetch();
        }else{
          GeoMereLaal.successCallbacks();
        } 
      
      }, 
    successCallbacks:function(){ 
      GeoMereLaal.updateLatitude_callback();
      GeoMereLaal.updateLongitude_callback();
      GeoMereLaal.onReceive();

    },
    onReceive:function(){         
     //This is a stub to be overridden by user's code 
    },
    onError:function(error){         
     //This can be overridden by user's code
     alert("We couldn't retrieve your location "); 
    },
    updateLatitude_callback:function(){
    //This is a callback stub to be overridden by user level code   
    },
    updateLongitude_callback:function(){
    //This is a callback stub to be overridden by user level code   
    }

  


}}();   

